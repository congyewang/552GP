\documentclass{article}
\usepackage{labreport}


\title{MATH552 Group Project}
\author{Congye Wang \& Kieran Molloy}
\date{October 2020}

\begin{document}

\maketitle

\begin{abstract}
Removing unwanted background noise from sound signals using Discrete Fourier Transform and its inverse (DFT/IDFT) manually by varying a threshold value.
\end{abstract}

\section{Introduction}\label{sec:intro}
The sound file being used is a .wav file, produced in previous work, and is represented in Figure.\ref{fig:cutout} this is a simple filestream data format where the data is simply stored as numerical values representing the amplitude, it is often considered the simplest audio format and as such is very useful for the task at hand. A .wav file can be read and written with ease, as it was partially designed for this purpose by IBM and Microsoft \cite{wav-format}.
When the file is read, it will be converted into numbers and then it will be ready for processing. When processing has finished, it can simply be written to a new file and stored. The processing that will be performed will remove all background/unwanted noise. 

\begin{figure}[ht]
    % Starting Signal
    \centering
    \includegraphics[height=6cm]{images/cutout.png} 
    \caption{Speech Cutout from Original Signal}
    \label{fig:cutout}
\end{figure}

\section{Method}\label{sec:method}
The file that is being worked is $1.64$ seconds long and consists of a woman saying "Let us go then, you and I" with a high pitch beeping noise in the background. To remove this noise we must perform a spectral analysis based method of removing amplitudes higher than a threshold. \cite{Unit_Notes}

\subsection{Discrete Fourier Transform}\label{subsec:DFT}
The discrete Fourier transform, or DFT, is the primary tool of digital signal processing. The foundation of the product is the fast Fourier transform (FFT), a method for computing the DFT with reduced execution time. Equation \ref{eq:dft} gives the DFT Equation.
\begin{equation}\label{eq:dft}
    c_n \approx F_n = \frac{1}{N}\sum_{k=0}^{N-1}{s(kT)e^{-2\pi i k n / N}}
\end{equation}
It can be noted that the negative values equate as shown in Eq.\ref{eq:F}

\begin{align}\label{eq:F}
    F_{-1} &= F_{N-1}, &F_{-2}= F_{N-2}
\end{align}

Equation \ref{eq:dft} takes a sequence of $N$ sample values of an analogue signal $s(t)$ and then transforms then to N complex numbers, this is called the Discrete Fourier Transform. \cite{owens:2017}

The inverse discrete fourier transform takes a sequence of N complex numbers and transforms them back into the original time sequence, as defined in Eq.\ref{eq:idft}

\begin{equation}\label{eq:idft}
    s(nT)=\sum_{k=0}^{N-1}{F_k e^{2\pi i k n / N}}
\end{equation}
for $n=0,1,\dots,N-1$

The MATLAB environment provides the functions \textit{fft} and \textit{ifft} to compute the discrete Fourier transform and its inverse, respectively. These are based on a C implementation documented in \cite{FFTW}. For the input sequence x and its transformed version X (the discrete-time Fourier transform at equally spaced frequencies around the unit circle), the two functions implement the relationships defined in Eq.\ref{eq:dft} and Eq.\ref{eq:idft}. (It must be noted that the MATLAB convention is to use a negative $j$ for the \textit{fft} function. This is an engineering convention; physics and pure mathematics typically use a positive $j$.)(\cite{ingle:2017})

By viewing a signal in the frequency domain it may be possible to remove unwanted
frequency components by setting them to zero then going back to the time domain (via
the IDFT). 

To perform these algorithms the signal must be folded around 0, the folding process is performed by Listing \ref{code:fold} and unfolding process is performed by Listing \ref{code:unfold}.
\lstinputlisting[firstline=102,lastline=107, language=MATLAB, caption=Matlab Folding Code Snippet,label={code:fold}]{code/Molloy.m}

\lstinputlisting[firstline=109,lastline=113, language=MATLAB, caption=Matlab Un-Folding Code Snippet,label={code:unfold}]{code/Molloy.m}

To remove the noise, specific values must be removed. This process is done by using a threshold value, $\alpha$, due to using a .wav file we are able to use MATLAB logical expressions to find all values exceeding $\alpha$ and set them to 0, as shown in Listing \ref{code:threshold}.

\lstinputlisting[firstline=29,lastline=32, language=MATLAB, caption=Matlab Threshold Removal Code Snippet,label={code:threshold}]{code/Molloy.m}

It is important to remove background noise whilst keeping as much detail as possible, to do this we visually inspect the plots produced (See Sec.\ref{sec:results}) and listen to the output file. 

\section{Results}\label{sec:results}
The initial $\alpha$ value is $10000$ and the results can be seen in Figure \ref{fig:10000}, in the residual signal there is very little removed, so $\alpha$ is halved. $\alpha = 5000$ displays significantly more removal, however only for a small section. So $\alpha$ must be reduced further.
\begin{figure}[h]
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include first image
      \includegraphics[width=\linewidth]{images/10000.png}  
      \caption{$\alpha =$10000 Signal}
      \label{fig:10000}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include second image
      \includegraphics[width=\linewidth]{images/5000.png}  
      \caption{$\alpha =$5000 Signal} 
      \label{fig:5000}
    \end{subfigure}
    \label{fig:10k}
    \caption{Initial $\alpha$ Values}
\end{figure}
Since the high pitch noise remains in $\alpha=4000$ (shown in Figure \ref{fig:4000}), it is again reduced to 3000, the residual signal in Figure \ref{fig:3000} shows removal across the entire signal, however the high pitch noise can still be heard
\begin{figure}[h]
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include first image
      \includegraphics[width=\linewidth]{images/4000.png}  
      \caption{$\alpha =$4000 Signal}
      \label{fig:4000}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include second image
      \includegraphics[width=\linewidth]{images/3000.png}  
      \caption{$\alpha =$3000 Signal}
      \label{fig:3000}
    \end{subfigure}
    \label{fig:4k}
    \caption{Secondary $\alpha$ Values}
\end{figure}
For $\alpha=2500$, the high pitch noise is gone, however it is important to keep as much detail as possible, so a higher interval is chosen, $\alpha = 2700$, shown in Figure \ref{fig:2k}
\begin{figure}[h]
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include first image
      \includegraphics[width=\linewidth]{images/2500.png}  
      \caption{$\alpha =$2500 Signal}
      \label{fig:2500}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include second image
      \includegraphics[width=\linewidth]{images/2700.png}  
      \caption{$\alpha =$2700 Signal}
      \label{fig:2700}
    \end{subfigure}
    \caption{Tertiary $\alpha$ Values}
    \label{fig:2k}
\end{figure}
The final threshold value is $2663$, as $\alpha = 2664$ keeps the high pitch noise we know this is the clearest threshold value whilst still removing any background noise. Shown in figure \ref{fig:2663-both} 
\begin{figure}[h]
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include first image
      \includegraphics[width=\linewidth]{images/2663.png}  
      \caption{$\alpha =$2663 Signal}
      \label{fig:2663-signal}
    \end{subfigure}
    \begin{subfigure}[b]{0.5\textwidth}
      \centering
      % include second image
      \includegraphics[width=\linewidth]{images/2663_Spectrum.png}  
      \caption{$\alpha =$2663 Spectrum}
      \label{fig:2663-spectrum}
    \end{subfigure}
    \caption{Final $\alpha$ Value}
    \label{fig:2663-both}
\end{figure}
Figure \ref{fig:2663-spectrum} demonstrates the folding and unfolding process of the audio clip, from top to bottom. The middle subplots show the threshold value being applied, the solitary spike is at $x=2664$, hence why $2663$ is the optimum threshold value.

\section{Conclusions}
Removing unwanted noise can be a trial and error process, whereby you must remove enough frequencies to remove the noise, whilst retaining enough frequencies to accurately represent the signal. Although a threshold is used here, each individual frequency could be selected and removed or kept, however this would be incredibly hard and time consuming. But would probably produce a better representation, with only the noise being removed. The final output signal produced sounds dull, this is due to higher frequencies being removed with the noise.


\renewcommand\bibname{References}
\printbibliography

\include{appendices/Appendix1}
\end{document}

